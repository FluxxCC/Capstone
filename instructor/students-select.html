<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Instructor â€” Choose Section</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="container centered">
      <div class="dashboard-main center-page">
        <h2 class="welcome">Choose Section</h2>
        <p class="subtitle accent">Select the section you handle</p>
        <div id="contentBox" class="buttons" style="width:min(92vw,560px);margin:0 auto"></div>
        <div class="buttons" style="width:min(92vw,560px);margin-top:1rem">
          <a class="role-button" href="/instructor/dashboard.html">Back</a>
        </div>
      </div>
    </main>
    <nav class="student-nav">
      <div class="student-nav-inner">
        <a href="/instructor/dashboard.html" aria-label="Home">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10.5l9-7 9 7"/><path d="M5 11v9h14v-9"/></svg>
        </a>
        <a href="/instructor/students.html" aria-label="Logs">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M3 10h18"/></svg>
        </a>
        <a href="/instructor/reports.html" aria-label="Reports">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5V5a2 2 0 012-2h10"/><path d="M20 7v12a2 2 0 01-2 2H6"/><path d="M9 7h6"/><path d="M9 11h6"/><path d="M9 15h6"/></svg>
        </a>
        <a href="/instructor/profile.html" aria-label="Profile">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>
        </a>
      </div>
    </nav>
    <script>
      function authHeaders(){ const t = sessionStorage.getItem('userToken'); return t ? { Authorization: 'Bearer ' + t } : {}; }
      document.addEventListener('DOMContentLoaded', async function(){
        const box = document.getElementById('contentBox');
        box.innerHTML = '<div class="skeleton-card"><div class="skeleton-line" style="width:60%"></div><div class="skeleton-line" style="width:40%;margin-top:8px"></div></div>';
        try {
          const r = await fetch('/api/instructor/me/assignments', { headers: authHeaders(), cache: 'no-store' });
          const j = await r.json().catch(()=>({}));
          const raw = Array.isArray(j?.data?.sections) ? j.data.sections.filter(Boolean) : [];
          const sections = raw.map(function(item){
            if (typeof item === 'string') return item;
            const course = String(item.course||item.courseCode||'').trim().toUpperCase();
            const section = String(item.section||item.sectionCode||'').trim().toUpperCase();
            return (course && section) ? (course+'-'+section) : (section || course || '');
          }).filter(Boolean);
          if (!sections.length) { box.innerHTML = '<div class="empty">No sections assigned</div>'; return; }
          box.innerHTML = '';
          const grid = document.createElement('div');
          grid.className = 'buttons';
          grid.style.display = 'grid'; grid.style.gridTemplateColumns = 'repeat(3,1fr)'; grid.style.gap = '0.5rem'; grid.style.width = '100%';
          sections.forEach(code => {
            const btn = document.createElement('button'); btn.className = 'role-button'; btn.type='button'; btn.textContent = code;
            btn.addEventListener('click', function(){
              const m = String(code).split('-');
              const course = (m[0] || '').toUpperCase();
              const section = (m[1] || '').toUpperCase();
              const url = '/instructor/students-list.html?course=' + encodeURIComponent(course) + '&section=' + encodeURIComponent(section);
              window.location.href = url;
            });
            grid.appendChild(btn);
          });
          box.appendChild(grid);
        } catch { box.innerHTML = '<div class="empty">Failed to load sections</div>'; }
      });
    </script>
    <script>
      (function(){
        const nav = document.querySelector('.student-nav'); if (!nav) return; nav.classList.add('slideable');
        let startY=null, lastY=null, moved=0;
        function start(e){ const t=e.touches?e.touches[0]:e; startY=t.clientY; lastY=startY; moved=0; }
        function move(e){ const t=e.touches?e.touches[0]:e; lastY=t.clientY; moved=lastY-startY; }
        function end(){ if (moved>30) { document.body.classList.add('nav-hidden'); } else if (moved<-30) { document.body.classList.remove('nav-hidden'); } else { document.body.classList.toggle('nav-hidden'); } startY=null; lastY=null; moved=0; }
        nav.addEventListener('touchstart', start, { passive:true });
        nav.addEventListener('touchmove', move, { passive:true });
        nav.addEventListener('touchend', end);
        nav.addEventListener('mousedown', start);
        nav.addEventListener('mousemove', function(e){ if (startY!==null) move(e); });
        nav.addEventListener('mouseup', end);
      })();
    </script>
  </body>
</html>
