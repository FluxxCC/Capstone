<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OJTonTrack â€” Super Admin Dashboard</title>
    <meta name="theme-color" content="#111827" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css" />
  </head>
  <body>
    <script>
      (async function(){
        try {
          const r = await fetch('/api/me');
          if (!r.ok) { window.location.replace('/index.html'); }
        } catch {
          window.location.replace('/index.html');
        }
      })();
    </script>
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script>
      function Dashboard() {
        function logout() {
          fetch('/api/logout', { method: 'POST' }).catch(()=>{});
          try {
            sessionStorage.removeItem('superAdminAuth');
            sessionStorage.removeItem('selectedRole');
            sessionStorage.removeItem('userAuth');
            sessionStorage.removeItem('userToken');
            sessionStorage.removeItem('role');
          } catch {}
          try {
            localStorage.removeItem('superAdminAuth');
            localStorage.removeItem('selectedRole');
            localStorage.removeItem('userAuth');
            localStorage.removeItem('userToken');
            localStorage.removeItem('role');
          } catch {}
          window.location.href = '/';
        }

        return React.createElement('main', { className: 'container centered' }, [
          React.createElement('div', { key: 'wrap', className: 'dashboard-main center-page' }, [
            React.createElement('h1', { key: 't', className: 'title' }, 'OJTonTrack'),
            React.createElement('p', { key: 'sub', className: 'subtitle' }, 'Coordinator (Super Admin) Dashboard'),
            React.createElement('div', { key: 'actions', className: 'buttons' }, [
              React.createElement('a', { key: 'all', className: 'role-button', href: '/admin/users-all' }, 'Manage All Users'),
              React.createElement('button', { key: 'linkAuth', className: 'role-button', onClick: async function(){ try { const t=sessionStorage.getItem('userToken'); const r=await fetch('/api/auth/link-all', { method:'POST', headers: { ...(t?{ Authorization:'Bearer '+t }:{} ) } }); const j=await r.json(); if (r.ok && j.ok) alert('Linked Supabase Auth accounts'); else alert(j.error||'Failed'); } catch { alert('Network error'); } } }, 'Link Supabase Auth'),
              React.createElement('button', { key: 'logout', className: 'role-button', onClick: logout }, 'Logout')
            ])
          ])
        ]);
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(Dashboard));
    </script>
  </body>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function(){
          navigator.serviceWorker.register('/service-worker.js').catch(function(){});
        });
      }
    </script>
  </html>
